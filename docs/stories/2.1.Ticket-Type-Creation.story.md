# Story 2.1: Ticket Type Creation

## Status
Draft

## Story
**As a** user,
**I want** to navigate to a 'Ticket Settings' page and create a new ticket type with a unique name,
**so that** I can organize my activities into my own custom categories.

## Acceptance Criteria
1. There is a dedicated "Settings" area in the application.
2. Within Settings, there is an option to "Create New Ticket Type."
3. The user can enter a name for the new type and save it.
4. The system prevents the creation of duplicate ticket type names with clear error messaging.
5. **Local Testing:** CLI command `deno test packages/testing/backend/ticket-types.test.ts` validates CRUD operations.
6. **Validation:** Ticket type names must be 3-50 characters, alphanumeric plus spaces.
7. **Performance:** Type creation saves within 300ms, updates UI immediately.

## Tasks / Subtasks
- [ ] **Task 1 (AC: 1)**: Create Settings page navigation
  - [ ] Subtask 1.1: Add Settings menu item to main navigation at `packages/frontend/src/components/ui/navigation.tsx`
  - [ ] Subtask 1.2: Create Settings page route at `packages/frontend/src/app/settings/page.tsx`
  - [ ] Subtask 1.3: Implement Settings layout component with section navigation
- [ ] **Task 2 (AC: 2, 3)**: Create Ticket Types management UI
  - [ ] Subtask 2.1: Create TicketTypesSettings component at `packages/frontend/src/components/tickets/TicketTypesSettings.tsx`
  - [ ] Subtask 2.2: Implement "Create New Ticket Type" form with name input field
  - [ ] Subtask 2.3: Add form submission handler that calls ticket-types API
  - [ ] Subtask 2.4: Display list of existing ticket types for the user
- [ ] **Task 3 (AC: 3, 4, 6, 7)**: Implement backend ticket-types API
  - [ ] Subtask 3.1: Create ticket-types controller at `packages/backend/src/app/ticket-types/ticket-types.controller.ts`
  - [ ] Subtask 3.2: Create ticket-types service at `packages/backend/src/app/ticket-types/ticket-types.service.ts`
  - [ ] Subtask 3.3: Create ticket-types module at `packages/backend/src/app/ticket-types/ticket-types.module.ts`
  - [ ] Subtask 3.4: Implement POST /api/ticket-types endpoint with name validation (3-50 chars, alphanumeric + spaces)
  - [ ] Subtask 3.5: Implement GET /api/ticket-types endpoint for user's ticket types
  - [ ] Subtask 3.6: Add duplicate name validation and error handling
- [ ] **Task 4 (AC: 4, 6)**: Implement validation and error handling
  - [ ] Subtask 4.1: Create validation DTO for ticket type creation with proper constraints
  - [ ] Subtask 4.2: Add frontend form validation for name requirements
  - [ ] Subtask 4.3: Implement error message display for duplicate names and validation failures
- [ ] **Task 5 (AC: 7)**: Optimize performance and UI responsiveness
  - [ ] Subtask 5.1: Implement optimistic UI updates for immediate feedback
  - [ ] Subtask 5.2: Add loading states and proper error recovery
  - [ ] Subtask 5.3: Ensure API response times meet 300ms requirement
- [ ] **Task 6 (AC: 5)**: Create comprehensive test suite
  - [ ] Subtask 6.1: Create backend tests at `packages/testing/backend/ticket-types.test.ts`
  - [ ] Subtask 6.2: Create frontend component tests for TicketTypesSettings component
  - [ ] Subtask 6.3: Create integration tests for full ticket type creation flow

## Dev Notes

### Previous Story Insights
No previous stories completed yet. This is one of the first stories in Epic 2 that establishes the foundation for custom ticket types.

### Data Models
**TicketType Model** (Enhanced from existing foundation):
- **Existing fields**: `id` (String UUID), `name` (String), `userId` (String)
- **Required enhancements**: None needed for this story - existing model supports basic creation
- **Validation rules**: Name must be 3-50 characters, alphanumeric plus spaces, unique per user
- **Relationships**: User relationship already established
[Source: docs/brownfield-architecture.md#data-models-and-schema-integration]

### API Specifications
**POST /api/ticket-types** - Create custom ticket type:
```typescript
interface CreateTicketTypeRequest {
  name: string; // 3-50 chars, alphanumeric + spaces
}
```

**GET /api/ticket-types** - List user's ticket types:
```typescript
interface TicketType {
  id: string;
  name: string;
  userId: string;
  createdAt: string;
  updatedAt: string;
}
```

**Authentication**: Must use existing JWT middleware patterns
**Validation**: Follow existing NestJS validation pipe patterns
**Error Handling**: Use current error response format
[Source: docs/brownfield-architecture.md#api-design-and-integration]

### Component Specifications
**Settings Page Structure**:
- Main route: `packages/frontend/src/app/settings/page.tsx`
- Settings navigation component for different sections
- TicketTypesSettings component as a section within Settings

**TicketTypesSettings Component**:
- Location: `packages/frontend/src/components/tickets/TicketTypesSettings.tsx`
- Features: Form for creating new types, list of existing types
- State management: Use existing Redux patterns with ticketTypesSlice
- UI components: Follow existing Radix UI and Tailwind patterns
[Source: docs/brownfield-architecture.md#new-file-organization-required-for-enhancement]

### File Locations
**Backend Files** (NEW):
- `packages/backend/src/app/ticket-types/ticket-types.controller.ts`
- `packages/backend/src/app/ticket-types/ticket-types.service.ts`
- `packages/backend/src/app/ticket-types/ticket-types.module.ts`
- `packages/backend/src/app/ticket-types/dto/create-ticket-type.dto.ts`

**Frontend Files** (NEW):
- `packages/frontend/src/app/settings/page.tsx`
- `packages/frontend/src/components/tickets/TicketTypesSettings.tsx`
- `packages/frontend/src/store/slices/ticketTypesSlice.ts`

**Testing Files** (NEW):
- `packages/testing/backend/ticket-types.test.ts`
- `packages/frontend/src/components/tickets/__tests__/TicketTypesSettings.test.tsx`

### Testing Requirements
**Backend Testing**:
- Use Deno test runner for backend tests
- Test CRUD operations for ticket types
- Test validation rules (name length, uniqueness)
- Test JWT authentication on endpoints
- Test error responses for duplicate names

**Frontend Testing**:
- Use Jest configuration for component tests
- Test form submission and validation
- Test error message display
- Test loading states and optimistic updates
- Test integration with Redux store

**Performance Testing**:
- API endpoints must respond within 300ms
- UI updates must be immediate (optimistic)
- Test with multiple ticket types to ensure scalability
[Source: docs/brownfield-architecture.md#testing-strategy-integration]

### Technical Constraints
**Database Constraints**:
- Use existing Prisma ORM patterns
- Follow existing database transaction patterns
- Ensure proper user data isolation

**API Constraints**:
- Follow existing NestJS controller patterns
- Use existing JWT authentication middleware
- Maintain existing OpenAPI documentation standards
- Follow current validation pipe patterns

**Frontend Constraints**:
- Use existing Redux Toolkit setup
- Follow established component patterns in `packages/frontend/src/components/ui/`
- Maintain existing Tailwind CSS styling patterns
- Follow current API client patterns in `packages/frontend/src/lib/api.ts`

**Performance Constraints**:
- Ticket type creation must save within 300ms
- UI must update immediately with optimistic updates
- Follow existing error handling and recovery patterns
[Source: docs/brownfield-architecture.md#integration-constraints]

### Testing
**Test File Locations**:
- Backend tests: `packages/testing/backend/ticket-types.test.ts`
- Frontend component tests: Follow existing Jest configuration
- Integration tests: Use existing test infrastructure

**Testing Standards**:
- Use Deno test runner for backend
- Jest for frontend components
- Follow existing test file organization patterns
- Maintain current code coverage requirements
- Test cross-browser compatibility for form interactions

**Specific Testing Requirements**:
- Validate 3-50 character name constraint
- Test duplicate name prevention
- Verify 300ms response time requirement
- Test JWT authentication on all endpoints
- Test error message display and recovery
[Source: docs/brownfield-architecture.md#testing-strategy-integration]

## Change Log

| Date       | Version | Description                              | Author        |
|------------|---------|------------------------------------------|---------------|
| 2025-08-02 | 1.0     | Initial story created with full technical context | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

## QA Results
*This section will be populated by the QA agent after the story is implemented.*
