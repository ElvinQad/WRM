# Story 2.3: Time-Aware State Visualization

## Status
Draft

## Story
**As a** user,
**I want** to instantly see the status of my tickets based on their border color,
**so that** I can quickly assess my schedule and what needs attention.

## Acceptance Criteria
1. Tickets scheduled in the future have a standard border color.
2. A ticket whose scheduled time is happening *now* has a distinct "Active" border color (e.g., green).
3. A ticket whose time has passed and has had *no interaction* has a distinct "Untouched" border color (e.g., red).
4. A ticket whose time has passed but *was interacted with* has a distinct "Confirmed" border color (e.g., amber).
5. **Data Granularity:** State visualization works across all view scales - detailed views (hourly/daily/weekly) show individual ticket states, monthly view shows aggregated daily productivity/completion indicators.
6. **Interaction Definition:** "Interaction" means ONLY editing title, description, or custom properties. Moving/resizing tickets, clicking, viewing, or opening detail modal does NOT count as interaction.

## Tasks / Subtasks
- [ ] **Task 1 (AC: 1-4)**: Implement ticket state calculation logic.
  - [ ] Subtask 1.1: Create service methods to determine ticket state based on current time and interaction history.
  - [ ] Subtask 1.2: Define state enum (Future, Active, Untouched, Confirmed) and corresponding color scheme.
- [ ] **Task 2 (AC: 1-4)**: Update `TicketComponent` with state-based styling.
  - [ ] Subtask 2.1: Modify `TicketComponent` to apply border colors based on calculated state.
  - [ ] Subtask 2.2: Ensure state colors are accessible and follow design system.
- [ ] **Task 3 (AC: 5)**: Implement monthly view productivity indicators.
  - [ ] Subtask 3.1: Extend `TicketAggregationService` to calculate daily completion/productivity rates.
  - [ ] Subtask 3.2: Update `MonthlyCalendarView` to display productivity indicators using color coding.
  - [ ] Subtask 3.3: Ensure monthly indicators are visually distinct from detailed ticket states.

## Dev Notes

### Previous Story Insights
This story builds on the data model enhancements from Stories 1.1 and 1.5, requiring state visualization to work across different data granularities.

### Data Models
- **Ticket State Enum**: `Future | Active | Untouched | Confirmed`
- **Monthly Productivity Metrics**: Daily completion rates and productivity scores from aggregated data
- **State Calculation**: Based on `start_time`, `end_time`, current time, and interaction timestamps
[Source: docs/prd/epic-2-intelligent-customizable-tickets.md]

### API Specifications
- No new API endpoints required - uses existing ticket data with interaction tracking
- Monthly view uses aggregated data from Story 1.5 with productivity calculations
[Source: docs/brownfield-architecture/3-proposed-architecture.md]

### Component Specifications
- **`TicketComponent`**: Enhanced with state-based styling at `packages/frontend/src/components/timeline/components/TicketComponent.tsx`
- **`MonthlyCalendarView`**: Enhanced with productivity indicators (from Story 1.5)
- **State calculation logic**: New utility functions for determining ticket states
[Source: docs/brownfield-architecture/3-proposed-architecture.md#new-components]

### File Locations
- Ticket component: `packages/frontend/src/components/timeline/components/TicketComponent.tsx`
- State utilities: `packages/frontend/src/components/timeline/utils/ticketState.ts`
- Monthly calendar: `packages/frontend/src/components/timeline/components/MonthlyCalendarView.tsx`

### Testing Requirements
- Unit tests for state calculation logic with various time scenarios
- Visual regression tests for color schemes and accessibility
- Integration tests for monthly productivity indicators
- Cross-browser compatibility tests for color rendering
[Source: docs/brownfield-architecture/2-architectural-goals-constraints.md]

### Technical Constraints
- Must maintain existing component architecture
- Color schemes must be accessible (WCAG compliance)
- State updates must be real-time as time progresses
- Performance impact minimal for large numbers of tickets
[Source: docs/brownfield-architecture/1-introduction.md, docs/brownfield-architecture/2-architectural-goals-constraints.md]

## Change Log

| Date       | Version | Description                              | Author        |
|------------|---------|------------------------------------------|---------------|
| 2025-07-24 | 1.0     | Initial story created with data granularity awareness | Sarah (Product Owner) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

## QA Results
*This section will be populated by the QA agent after the story is implemented.*
